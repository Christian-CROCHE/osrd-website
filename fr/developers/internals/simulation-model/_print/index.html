<!doctype html><html lang=fr class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.101.0"><link rel=canonical type=text/html href=https://dgexsolutions.github.io/osrd-website/fr/developers/internals/simulation-model/><link rel=alternate type=application/rss+xml href=https://dgexsolutions.github.io/osrd-website/fr/developers/internals/simulation-model/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/osrd-website/favicons/favicon.ico><link rel=apple-touch-icon href=/osrd-website/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/osrd-website/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/osrd-website/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/osrd-website/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/osrd-website/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/osrd-website/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/osrd-website/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/osrd-website/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/osrd-website/favicons/android-192x192.png sizes=192x192><title>Modèle de simulation de la signalisation et des aiguillages | OSRD</title><meta name=description content="Décrit le fonctionnement du poste d'aiguillage virtuel et de la signalisation"><meta property="og:title" content="Modèle de simulation de la signalisation et des aiguillages"><meta property="og:description" content="Décrit le fonctionnement du poste d'aiguillage virtuel et de la signalisation"><meta property="og:type" content="website"><meta property="og:url" content="https://dgexsolutions.github.io/osrd-website/fr/developers/internals/simulation-model/"><meta property="og:site_name" content="OSRD"><meta itemprop=name content="Modèle de simulation de la signalisation et des aiguillages"><meta itemprop=description content="Décrit le fonctionnement du poste d'aiguillage virtuel et de la signalisation"><meta name=twitter:card content="summary"><meta name=twitter:title content="Modèle de simulation de la signalisation et des aiguillages"><meta name=twitter:description content="Décrit le fonctionnement du poste d'aiguillage virtuel et de la signalisation"><link rel=preload href=/osrd-website/scss/main.min.51e36810bd9111b15befd63346ee79e57d2fa29d89838a5811841b13b372d0f5.css as=style><link href=/osrd-website/scss/main.min.51e36810bd9111b15befd63346ee79e57d2fa29d89838a5811841b13b372d0f5.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/osrd-website/fr/><span class=navbar-logo><svg id="Calque_1" data-name="Calque 1" viewBox="0 0 64 64" sodipodi:docname="logo_osrd_seul_blanc.svg" width="64" height="64" inkscape:version="1.1.2 (0a00cf5339, 2022-02-04)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/"><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="3440" inkscape:window-height="1380" id="namedview47" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:zoom="3.0016455" inkscape:cx="12.992873" inkscape:cy="71.294228" inkscape:window-x="0" inkscape:window-y="32" inkscape:window-maximized="1" inkscape:current-layer="Calque_1" inkscape:pagecheckerboard="0"/><defs id="defs4"><style id="style2">.cls-1,.cls-2,.cls-3,.cls-4,.cls-7{fill:none;stroke-linecap:round;stroke-linejoin:round}.cls-1,.cls-4{stroke:#aa026d}.cls-1,.cls-2{stroke-width:10px}.cls-2,.cls-3{stroke:#71196f}.cls-3,.cls-4{stroke-width:5px}.cls-5,.cls-6{font-size:119.48px}.cls-5{fill:#71196f;font-family:AvenirLTStd-Heavy,Avenir LT Std}.cls-6{fill:#aa026d;font-family:AvenirLTStd-Medium,Avenir LT Std}.cls-7{stroke:#fff;stroke-width:.75px}</style></defs><title id="title6">logo-OSRD_</title><g id="g847" transform="matrix(0.09645818,0,0,0.09645818,7.1489968,-1.215e-6)"><path inkscape:connector-curvature="0" class="cls-1" d="m389.52 658.5v-88c0-199.26-91.83-331.42-279.82-362" id="path8" style="stroke:#f2f2f2;stroke-opacity:1"/><path inkscape:connector-curvature="0" class="cls-1" d="m298.5 658.5v-87.07c0-156.89-75.34-258.73-229.71-276" id="path10" style="stroke:#f2f2f2;stroke-opacity:1"/><path inkscape:connector-curvature="0" class="cls-2" d="m216.77 658.5v-70.49c0-121.76-58.68-200.64-178.91-213.6" id="path12" style="stroke:#a0a0a0;stroke-opacity:1"/><path inkscape:connector-curvature="0" class="cls-2" d="M125.74 658.5V617.36C125.74 533.21 86.13 478 5 466.95" id="path14" style="stroke:#a0a0a0;stroke-opacity:1"/><path inkscape:connector-curvature="0" class="cls-2" d="m125.74 658.5v-88c0-199.26 91.84-331.42 279.83-362" id="path16" style="stroke:#a0a0a0;stroke-opacity:1"/><path inkscape:connector-curvature="0" class="cls-2" d="m216.77 658.5v-87.07c0-156.89 75.34-258.73 229.71-276" id="path18" style="stroke:#a0a0a0;stroke-opacity:1"/><path inkscape:connector-curvature="0" class="cls-1" d="m298.5 658.5v-70.49c0-121.76 58.68-200.64 178.91-213.6" id="path20" style="stroke:#f2f2f2;stroke-opacity:1"/><path inkscape:connector-curvature="0" class="cls-1" d="m389.52 658.5v-41.14c0-84.15 39.62-139.36 120.75-150.41" id="path22" style="stroke:#f2f2f2;stroke-opacity:1"/><line class="cls-3" x1="126" y1="642.5" x2="126" y2="122.5" id="line24" style="stroke:#a0a0a0;stroke-opacity:1"/><line class="cls-3" x1="217" y1="642.5" x2="217" y2="2.5" id="line26" style="stroke:#a0a0a0;stroke-opacity:1"/><line class="cls-4" x1="299" y1="642.5" x2="299" y2="2.5" id="line28" style="stroke:#f7f7f7;stroke-opacity:1"/><line class="cls-4" x1="390" y1="642.5" x2="390" y2="122.5" id="line30" style="stroke:#f2f2f2;stroke-opacity:1"/></g></svg></span><span class=font-weight-bold>OSRD</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/osrd-website/fr/who-we-are/><span>Qui sommes-nous ?</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/osrd-website/fr/users/><span>Utilisateurs</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/osrd-website/fr/developers/><span class=active>Développeurs</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/osrd-website/fr/partnership/><span>Partenariats</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/osrd-website/fr/news/><span>News</span></a></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Français</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/osrd-website/en/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Rechercher dans ce site…" aria-label="Rechercher dans ce site…" autocomplete=off data-offline-search-index-json-src=/osrd-website/offline-search-index.e098c7beda073f4aa9c67544390e69df.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>Version imprimable multipages.
<a href=# onclick="return print(),!1">Cliquer ici pour imprimer</a>.</p><p><a href=/osrd-website/fr/developers/internals/simulation-model/>Retour à la version par défaut</a>.</p></div><h1 class=title>Modèle de simulation de la signalisation et des aiguillages</h1><div class=lead>Décrit le fonctionnement du poste d&rsquo;aiguillage virtuel et de la signalisation</div><ul><li>1: <a href=#pg-316df4779a0afa416a7ab4f49a562a1a>Éléments mobiles</a></li><li>2: <a href=#pg-9f0fb2d0c4a2e33b802cfc129209bdd6>Localisation</a></li><li>3: <a href=#pg-f13a3aba85bc2da02a5e44b3909dd138>Reservation</a></li><li>4: <a href=#pg-8ad0109aa919c10778b63e2b8f4bfd8e>Routage</a></li><li>5: <a href=#pg-2a543f4825ceadd99db238fa5e4dbee0>Espacement</a></li><li>6: <a href=#pg-3b89cfa7c83abb27ce1a6db5b915a633>Ordonnancement</a></li><li>7: <a href=#pg-1ff9412ee379f9154590bd054b704bee>Signalisation</a></li><li>8: <a href=#pg-0f8ea1a8f1482a3fa7a91a860088c26d>Train</a></li></ul><div class=content><div class="pageinfo pageinfo-warning"><p>Ce modèle n&rsquo;est pas finalisé, et en attente d&rsquo;implémentation</p></div><h2 id=architecture>Architecture</h2><pre tabindex=0><code class=language-mermaid data-lang=mermaid>flowchart TD
    %%%% NODES

    train[Train]
    %% ↓
    signaling[Signalisation]
    %% ↓
    routing[Routage]
    ordering[Ordonnancement]
    spacing[&#34;Espacement&#34;]
    %% ↓
    reservation[Réservation]
    %% ↓
    location[Localisation]
    movable-elements[&#34;Éléments mobiles&#34;]

    %%%% EDGES

    train -- réagit à --&gt; signaling
    train -- réclame les itinéraires --&gt; ordering
    signaling -- observe --&gt; routing
    ordering -- réserve --&gt; routing
    signaling -- observe --&gt; spacing
    spacing -- observe --&gt; reservation
    spacing -- observe --&gt; movable-elements
    routing -- observe et réserve --&gt; reservation
    reservation -- observe --&gt; location
    reservation -- réserve et actionne --&gt; movable-elements
    train -- informe --&gt; location

    %%%% CLICKABLE LINKS

    click train href &#34;./train/&#34; _self
    click ordering href &#34;./ordering/&#34; _self
    click signaling href &#34;./signaling/&#34; _self
    click routing href &#34;./routing/&#34; _self
    click spacing href &#34;./spacing/&#34; _self
    click reservation href &#34;./reservation/&#34; _self
    click location href &#34;./location/&#34; _self
    click movable-elements href &#34;./movable-elements/&#34; _self
</code></pre><h2 id=todo>TODO</h2><ul><li>overlaps</li><li>opposing movement protection</li></ul></div></div><div class=td-content style=page-break-before:always><h1 id=pg-316df4779a0afa416a7ab4f49a562a1a>1 - Éléments mobiles</h1><div class=lead>Gère l&rsquo;état des organes de commande des aiguilles, passages à niveau, …</div><h2 id=description>Description</h2><p>Chaque élément mobile, aiguille ou passage à niveau, a une liste d&rsquo;états possibles.
Ces états sont mutuellement exclusifs.</p><h2 id=dépendances>Dépendances</h2><ul><li>une liste d&rsquo;élements mobiles</li><li>liste des états possibles de chaque élément mobile</li></ul><h2 id=opérations-possibles>Opérations possibles</h2><ul><li>observer un élément mobile</li><li>vérouiller / dévérouiller un élément mobile</li><li>bouger un élément mobile</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-9f0fb2d0c4a2e33b802cfc129209bdd6>2 - Localisation</h1><div class=lead>Fournit les informations de position des trains sur le réseau</div><h2 id=description>Description</h2><p>La couche de localisation suit le déplacement des trains dans l&rsquo;infrastructure</p><h2 id=dépendances>Dépendances</h2><ul><li>une liste de zones</li></ul><h2 id=opérations>Opérations</h2><ul><li>Occuper une zone</li><li>Libérer une zone</li><li>Observer les changements d&rsquo;occupation d&rsquo;une zone</li></ul><h2 id=exigences-de-conception>Exigences de conception</h2><ul><li>il doit être possible de suivre les changements d&rsquo;occupation d&rsquo;une zone</li><li>il <em>devra</em> être possible de suivre les déplacements d&rsquo;un train</li><li>il <em>devra</em> être possible d&rsquo;implémenter un système de bloc mobile</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-f13a3aba85bc2da02a5e44b3909dd138>3 - Reservation</h1><div class=lead>Gère l&rsquo;état de réservation des zones</div><h2 id=description>Description</h2><p>Les zones (ou TVDSection / DetectionSection) sont des partitions physiques des voies :</p><ul><li>capables de détecter la présence d&rsquo;un train</li><li>qui fournissent un service de réservation à l&rsquo;usage des routes</li></ul><p>Chaque zone a un certain nombre de configurations différentes.
Par exemple, une zone sans aiguille aura deux configurations :</p><ul><li>sens pair</li><li>sens impair</li></ul><p>Une zone avec une aiguille aura 4 configurations :</p><ul><li>sens pair voie principale</li><li>sens impair voie principale</li><li>sens pair voie déviation</li><li>sens impair voie déviation</li></ul><p><strong>Chaque zone ne peut être réservée que pour une configuration donnée à la fois, mais peut être réservée simultanément par plusieurs routes</strong>.
Une zone ne peut changer de configuration que lorsqu&rsquo;elle n&rsquo;est pas réservée.</p><p>L&rsquo;enclanchement de transit est un enclanchement qui vise à empêcher le mouvement d&rsquo;un appareil de voie lorsqu&rsquo;un train est en approche.
Il concerne les organes de commandes des aiguilles.
un enclanchement est un système qui permet d&rsquo;imposer des ordres de manoeuvre sur un système, soit imposer des interdictions</p><h2 id=exigences-de-conception>Exigences de conception</h2><ul><li>Les zones doivent pouvoir être <strong>vérouillées</strong> dans une configuration particulière.</li><li>Il doit être possible pour plusieurs routes de <strong>partager une réservation</strong> de configuration.</li><li>Il doit être possible d&rsquo;observer l&rsquo;<strong>évolution de statut d&rsquo;une réservation</strong>.</li></ul><h2 id=état>État</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>ZoneReservationStatus</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>IntEnum</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># the head of the train didn&#39;t yet enter the zone</span>
</span></span><span style=display:flex><span>    <span style=color:#000>AWAITING_USE</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>auto</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># the train is inside the zone</span>
</span></span><span style=display:flex><span>    <span style=color:#000>IN_USE</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>auto</span><span style=color:#000;font-weight:700>()</span> 
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># the train went and left</span>
</span></span><span style=display:flex><span>    <span style=color:#000>AWAITING_RELEASE</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>auto</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>ZoneReservation</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>train</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>TrainHandle</span>
</span></span><span style=display:flex><span>    <span style=color:#000>status</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>ZoneReservationStatus</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>async</span> <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>wait_for_status</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>status</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>raise</span> <span style=color:#3465a4>NotImplemented</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>async</span> <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>release</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>raise</span> <span style=color:#3465a4>NotImplemented</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>ZoneState</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># the current layout of the zone</span>
</span></span><span style=display:flex><span>    <span style=color:#000>configuration</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>ZoneConfiguration</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># the list of trains which hold a right to use the zone in its current configuration</span>
</span></span><span style=display:flex><span>    <span style=color:#000>reservations</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>Set</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>TrainHandle</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># the list of trains currently inside the zone</span>
</span></span><span style=display:flex><span>    <span style=color:#000>occupation</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>Set</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>TrainHandle</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@property</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>is_locked</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;When any train holds a reservation for a route, the zone cannot change configuration&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>reservations</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>async</span> <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>reserve</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>configuration</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>-&gt;</span> <span style=color:#000>ZoneReservation</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>raise</span> <span style=color:#3465a4>NotImplemented</span>
</span></span></code></pre></div><h2 id=dépendances>Dépendances</h2><ul><li>une liste de zones</li><li>capacité d&rsquo;observer l&rsquo;occupation des zones</li><li>capacité d&rsquo;actionner les éléments mobiles</li></ul><h2 id=opérations>Opérations</h2><ul><li><strong>cantonnement</strong>: Observer l&rsquo;occupation de la zone</li><li><strong>cantonnement</strong>: Observer la configuration de la zone (?)</li><li><strong>routage</strong>: Réserver une configuration de zone</li><li><strong>routage</strong>: Attendre que la réservation de la zone soit utilisée par son train</li><li><strong>routage</strong>: Relacher une réservation de zone</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-8ad0109aa919c10778b63e2b8f4bfd8e>4 - Routage</h1><div class=lead>Gère le cycle de vie des itinéraires</div><h2 id=description>Description</h2><ul><li>Les routes sont formées à la demande. Plusieurs demandes peuvent avoir cours en simultané. Il est de la responsabilité du composant qui active les routes de s&rsquo;assurer que les demandes sont faites dans le bon ordre.</li><li>Une route est dite commandée lorsqu&rsquo;un processus d&rsquo;activation est en cours, et elle devient formée lorsque le processus se termine</li><li>Une route peut être activée alors qu&rsquo;un train est déjà en train de la parcourir. Il faut seulement qu&rsquo;il soit possible de réserver les zones dans la bonne configuration.</li></ul><div class="alert alert-info" role=alert>certains postes d&rsquo;aiguillages ont un enclanchement entre itinéraires de sens contraire (affrontement) qui empêche l&rsquo;activation d&rsquo;une route en menant à une zone avec un transit en sens contraire.</div><h2 id=exigences-de-conception>Exigences de conception</h2><ul><li>Le système doit permettre à la <strong>signalisation</strong> de déterminer si la route est <strong>prête à être empruntée</strong>.</li><li>Le système doit permettre l&rsquo;<strong>ordonnancement</strong> des trains selon des critères configurables.</li><li>Le système doit optionnellement permettre la destruction progressive (<strong>transit souple</strong>) de l&rsquo;itinéraire après le passage du train.</li><li>Commande simultanée de l&rsquo;itinéraire</li></ul><h2 id=possibilités-de-design>Possibilités de design</h2><p>La contrainte la plus importante est la réaction des signaux aux itinéraires devant eux. Traditionnellement, les signaux réagissent à la complète formation d&rsquo;une des routes devant eux. Cette formulation, si elle est sûre, impose plusieurs contraintes:</p><ul><li>Il est nécessaire d&rsquo;associer un état à chaque itinéraire.</li><li>Les signaux doivent aggréger l&rsquo;état de tous les itinéraires devant eux. Il peut y en avoir beaucoup.</li></ul><p>Une autre possibilité est d&rsquo;insérer un objet intermédiaire entre le signal et les routes devant lui, qui serait explicitement notifié par le processus d&rsquo;activation de l&rsquo;itinéraire de son état. Il existerait un objet de ce genre par couple <code>(détecteur, direction)</code> d&rsquo;où une route part.</p><p>La seconde option nous semble préférable, car elle permet d&rsquo;avoir un couplage moins fort entre la signalisation et les itinéraires.</p><h2 id=dépendances>Dépendances</h2><ul><li>une liste d&rsquo;élements mobiles</li><li>liste des états possibles de chaque élément mobile</li></ul><h2 id=opérations>Opérations</h2><ul><li><strong>activer une route</strong>: démarre un processus asynchrone qui ne se terminera que lorsque la route aura été réservée. Un objet permettant d&rsquo;attendre que la route soit détruite après le passage du train est retourné</li><li><strong>observer un point d&rsquo;entrée d&rsquo;itinéraire</strong> permet à la signalisation de protéger les appareils de voie</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@dataclass</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>RouteHandle</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>route</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>Route</span>
</span></span><span style=display:flex><span>    <span style=color:#000>zone_handles</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>List</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>ZoneReservationHandle</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>async</span> <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>release</span><span style=color:#000;font-weight:700>():</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;This method must be awaited on for the route to release reservations behind the train&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>release_group</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>route</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>release_groups</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>            <span style=color:#000>last_zone_index</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>release_group</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>last_zone_index</span>
</span></span><span style=display:flex><span>            <span style=color:#000>zone_handle</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>zone_handles</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>last_zone_index</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>zone_handle</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>wait_for_status</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>train</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>last_zone</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>release</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>train</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Route</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>async</span> <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>activate</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>route</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>train</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>-&gt;</span> <span style=color:#000>RouteHandle</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># zone_sequence is a list of the zones of the route,</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># sorted by any absolute order to avoid deadlocks</span>
</span></span><span style=display:flex><span>        <span style=color:#000>handles</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[]</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>zone</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>config</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>route</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>zone_reservation_sequence</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>            <span style=color:#000>handles</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>append</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>zone</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>reserve</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>config</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>train</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># open and close the entrance signals</span>
</span></span><span style=display:flex><span>        <span style=color:#000>route</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>entry_trigger</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>open</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>route</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>zones</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>wait_until_train_leaves</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#000>route</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>entry_trigger</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>close</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>RouteHandle</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>route</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>handles</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-2a543f4825ceadd99db238fa5e4dbee0>5 - Espacement</h1><div class=lead>Gère l&rsquo;état des cantons</div><h2 id=couche-de-cantonnement>Couche de cantonnement</h2><p>La couche de cantonnement gère des routes de signal à signal (canton).
Elle permet à la signalisation d&rsquo;observer l&rsquo;état d&rsquo;un groupe
de zones protégées par chaque signal, et de trouver le signal
suivant dans la chaîne.</p><p>Chaque canton porte les informations statiques suivantes:</p><ul><li>les zones protégées par le canton, et leur configuration attendue (ce qui inclus l&rsquo;état des éléments mobiles)</li><li>les signaux de début et de fin (optionnels)</li></ul><p>Un canton est <strong>actif</strong> si tous ses éléments mobiles sont dans la position requise.</p><div class="alert alert-warning" role=alert><h4 class=alert-heading>TODO</h4>Un canton devrait-il être actif quand toutes ses zones sont dans la configuration requise ? Dans ce cas, les cantons de sens contraire seront inactifs.</div><h2 id=état>État</h2><p>L&rsquo;état du canton est une combinaison de:</p><ul><li>si toutes les zones sont correctement réservées</li><li>si une des zones est occupée</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000>SignalingRouteState</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>reserved</span>: <span style=color:#204a87;font-weight:700>bool</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>occupied</span>: <span style=color:#204a87;font-weight:700>bool</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Les cantons n&rsquo;ont pas d&rsquo;état persistant. Ils sont à tout instant capables de recalculer leur état.</p><h2 id=opérations>Opérations</h2><ul><li>On peut demander, étant une liste de signaling routes partant du même point, laquelle est <strong>active</strong> (si il y en a une), et son état. Cette opération est commune à la couche d&rsquo;API, et non à une signaling route en particulier.</li></ul><h2 id=exigences-de-conception>Exigences de conception</h2><ul><li>chaque signal doit connaître le <strong>prochain signal compatible</strong></li><li>chaque signal doit connaître les <strong>zones qu&rsquo;il protège</strong></li><li><strong>compatibilité modules signalisation</strong> : les modules doivent créer les cantons entre chaque signaux. Chaque canton a un système de signalisation associé.</li><li><strong>compatibilité pathfinding</strong> : Le pathfinding se fait dans le produit du graphe de routage et du graphe de cantons.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-3b89cfa7c83abb27ce1a6db5b915a633>6 - Ordonnancement</h1><div class=lead>Décide de l&rsquo;ordre de formation des itinéraires</div><h2 id=définition>Définition</h2><p>La couche d&rsquo;ordonnancement a pour responsabilité d&rsquo;établir l&rsquo;ordre de commande des itinéraires, et par conséquent, l&rsquo;ordre de passage des trains.
La méthode exacte utilisée pour prendre cette décision n&rsquo;importe pas, du moment qu&rsquo;elle garanti que la simulation se termine (elle ne doit pas amener de trains en nez-à-nez, ou créer d&rsquo;autre cas de figure de blocage).</p><p>Il est possible d&rsquo;implémenter un module d&rsquo;ordonnancement via des tableaux d&rsquo;ordre de succession des trains aux aiguilles.</p><h2 id=exigences-de-conception>Exigences de conception</h2><ul><li>Il doit être possible de connecter n&rsquo;importe quel algorithme d&rsquo;ordonnancement</li><li>Le module d&rsquo;ordonnancement doit blocker puis redémarrer des demandes d&rsquo;itinéraire.</li></ul><h2 id=opérations>Opérations</h2><ul><li><strong>train</strong>: Le train <strong>demande les itinéraires</strong> devant lui, aussi loin qu&rsquo;il peut. Sa demande peut être mise en attente du passage d&rsquo;un autre train.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-1ff9412ee379f9154590bd054b704bee>7 - Signalisation</h1><div class=lead>Gère l&rsquo;état des signaux</div><h2 id=description>Description</h2><p>La couche de signalisation comprend l&rsquo;ensemble des signaux, qui réagissent au cantonnement et à la réservation.
Les signaux peuvent être de différent types, et sont chargés de manière modulaire. Seul importe leur comportement
vis-à-vis de l&rsquo;état de l&rsquo;infrastructure, et la réaction des trains à la signalisation.</p><h2 id=état>État</h2><p>Chaque système de signalisation a son type d&rsquo;état de signal.</p><p>Étant donné un type de signal, il doit être possible de :</p><ul><li>savoir s&rsquo;il est contraignant</li><li>déterminer une représentation graphique de ce signal</li><li><strong>TODO</strong>: il devra être possible de faire réagit un train à ce signal</li></ul><h2 id=dépendances>Dépendances</h2><ul><li>capacité d&rsquo;observer l&rsquo;état des routes, pour les signaux qui débutent une route</li><li>possibilité d&rsquo;observer l&rsquo;état des cantons devant le signal, de sélectionner le canton actif, et de réagir en fonction de l&rsquo;occupation du canton et du signal de fin de canton</li></ul><h2 id=opérations>Opérations</h2><ul><li><strong>observer le signal</strong></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-0f8ea1a8f1482a3fa7a91a860088c26d>8 - Train</h1><div class=lead>Représente un train dans la simulation</div><h2 id=description>Description</h2><p>Les contraintes sur ce qu&rsquo;est un train sont relativement faibles.
Il doit seulement avoir un identifiant, qui permet aux autres systèmes de garder des références vers des trains.</p><h2 id=exigences-de-conception>Exigences de conception</h2><ul><li>Les trains <strong>occupent les zones</strong>.</li><li>Les trains doivent être <strong>suivis</strong> pour préserver leur <strong>ordre de passage</strong>.</li><li>Les trains ont pour responsabilité de <strong>demander les itinéraires</strong> devant eux.</li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=LinkedIn aria-label=LinkedIn><a class=text-white target=_blank rel=noopener href=https://www.linkedin.com/company/dgex-solutions/ aria-label=LinkedIn><i class="fab fa-linkedin"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel=noopener href=https://twitter.com/dgexsolutions aria-label=Twitter><i class="fab fa-twitter"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/DGEXSolutions/osrd aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel=noopener href=https://example.org/slack aria-label=Slack><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel=noopener href=https://example.org/mail aria-label="Developer mailing list"><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 DGEX Solutions Tous droits réservés</small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/mermaid@8.13.4/dist/mermaid.min.js integrity="sha512-JERecFUBbsm75UpkVheAuDOE8NdHjQBrPACfEQYPwvPG+fjgCpHAz1Jw2ci9EXmd3DdfiWth3O3CQvcfEg8gsA==" crossorigin=anonymous></script><style>.markmap>svg{width:100%;height:300px}</style><script>window.markmap={autoLoader:{manual:!0}}</script><script src=https://cdn.jsdelivr.net/npm/markmap-autoloader></script>
<script src=/js/tabpane-persist.js></script>
<script src=/osrd-website/js/main.min.388e1698db452a79196d63fdb03f54c101b02ecbf065f125f580520ae8be8551.js integrity="sha256-OI4WmNtFKnkZbWP9sD9UwQGwLsvwZfEl9YBSCui+hVE=" crossorigin=anonymous></script></body></html>